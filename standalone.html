<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ® äº²æˆšå¤§ä½œæˆ˜</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 420px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .header {
      background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
      color: white;
      padding: 20px;
      text-align: center;
    }
    .header h1 { font-size: 24px; margin-bottom: 5px; }
    .header p { font-size: 14px; opacity: 0.9; }
    
    .battle-area { padding: 20px; }
    
    .characters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .char-btn {
      flex: 1; min-width: 80px; padding: 12px 8px;
      border: 2px solid #eee; border-radius: 12px;
      background: white; cursor: pointer; font-size: 13px;
      transition: all 0.2s;
    }
    .char-btn:hover { border-color: #ff6b6b; }
    .char-btn.active { border-color: #ff6b6b; background: #fff5f5; color: #ff6b6b; }
    
    .hp-section { margin-bottom: 20px; }
    .hp-label { display: flex; justify-content: space-between; margin-bottom: 5px; }
    .hp-bar {
      height: 24px; background: #eee; border-radius: 12px;
      overflow: hidden; position: relative;
    }
    .hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff6b6b, #ff8787);
      border-radius: 12px;
      transition: width 0.5s ease;
    }
    .hp-text {
      position: absolute; right: 10px; top: 50%;
      transform: translateY(-50%); font-size: 12px; font-weight: bold; color: #666;
    }
    
    .bubble {
      background: #f5f5f5; padding: 16px 20px;
      border-radius: 16px; margin-bottom: 15px;
      position: relative; font-size: 16px; line-height: 1.5;
    }
    .bubble::before {
      content: ''; position: absolute; top: -12px; left: 20px;
      border: 12px solid transparent; border-bottom-color: #f5f5f5;
    }
    .bubble .who { font-size: 12px; color: #999; margin-bottom: 5px; }
    
    .input-section { margin-top: 20px; }
    .input-row { display: flex; gap: 10px; }
    input[type="text"] {
      flex: 1; padding: 14px 16px;
      border: 2px solid #eee; border-radius: 12px;
      font-size: 16px; outline: none;
    }
    input[type="text"]:focus { border-color: #ff6b6b; }
    .send-btn {
      width: 50px; height: 50px;
      border: none; border-radius: 12px;
      background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
      color: white; font-size: 20px; cursor: pointer;
    }
    
    .quick-btns { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; }
    .quick-btn {
      padding: 8px 14px; border: 1px solid #ddd;
      border-radius: 20px; background: white;
      font-size: 13px; cursor: pointer;
    }
    .quick-btn:hover { border-color: #ff6b6b; color: #ff6b6b; }
    
    .stats { display: flex; justify-content: center; gap: 20px; padding: 15px; background: #f9f9f9; border-radius: 12px; margin-bottom: 15px; }
    .stat { text-align: center; }
    .stat-num { font-size: 20px; font-weight: bold; color: #ff6b6b; }
    .stat-label { font-size: 12px; color: #999; }
    
    .round-info { text-align: center; font-size: 12px; color: #999; margin-bottom: 10px; }
    
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 100; }
    .modal.show { display: flex; }
    .modal-content { background: white; padding: 30px; border-radius: 20px; max-width: 350px; width: 90%; text-align: center; }
    .modal h2 { margin-bottom: 15px; }
    .damage-show { font-size: 48px; font-weight: bold; color: #ff6b6b; margin: 15px 0; }
    .comment { color: #666; margin-bottom: 20px; }
    .modal-btn { width: 100%; padding: 14px; border: none; border-radius: 12px; background: linear-gradient(135deg, #ff6b6b, #ee5a5a); color: white; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ® äº²æˆšå¤§ä½œæˆ˜</h1>
      <p>ä¼˜é›…åº”å¯¹äº²æˆšçš„çµé­‚æ‹·é—®</p>
    </div>
    
    <div class="battle-area">
      <div class="characters">
        <button class="char-btn active" onclick="selectChar('å¤§å§¨')">ğŸ‘© å¤§å§¨</button>
        <button class="char-btn" onclick="selectChar('å”å”')">ğŸ‘¨ å”å”</button>
        <button class="char-btn" onclick="selectChar('å¥¶å¥¶')">ğŸ‘µ å¥¶å¥¶</button>
      </div>
      
      <div class="stats">
        <div class="stat"><div class="stat-num" id="winCount">0</div><div class="stat-label">èƒœåˆ©</div></div>
        <div class="stat"><div class="stat-num" id="totalDamage">0</div><div class="stat-label">æ€»ä¼¤å®³</div></div>
      </div>
      
      <div class="hp-section">
        <div class="hp-label"><span id="charName">ğŸ‘© å¤§å§¨</span><span id="hpPercent">100%</span></div>
        <div class="hp-bar"><div class="hp-fill" id="hpFill" style="width: 100%"></div><span class="hp-text" id="hpText">100/100</span></div>
      </div>
      
      <div class="round-info" id="roundInfo">ç¬¬ 1 è½®</div>
      
      <div class="bubble">
        <div class="who" id="whoLabel">ğŸ‘© å¤§å§¨ è¯´ï¼š</div>
        <div id="questionText">æ‰¾å¯¹è±¡äº†å—ï¼Ÿéƒ½28äº†ï¼Œè¯¥æ€¥äº†ï¼</div>
      </div>
      
      <div class="input-section">
        <div class="input-row">
          <input type="text" id="answerInput" placeholder="è¾“å…¥ä½ çš„å›ç­”..." onkeypress="if(event.key==='Enter')submitAnswer()">
          <button class="send-btn" onclick="submitAnswer()">â¤</button>
        </div>
        <div class="quick-btns">
          <button class="quick-btn" onclick="useQuick('å¤§å§¨ï¼Œæ‚¨åƒèœåƒèœ')">åƒèœåƒèœ</button>
          <button class="quick-btn" onclick="useQuick('å¤§å§¨ï¼Œæ‚¨å®¶XXå‘¢ï¼Ÿ')">åé—®å›å»</button>
          <button class="quick-btn" onclick="useQuick('ä¸æ€¥ä¸æ€¥')">ä¸æ€¥ä¸æ€¥</button>
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal" id="resultModal">
    <div class="modal-content">
      <h2>ğŸ’¥ é€ æˆä¼¤å®³</h2>
      <div class="damage-show" id="damageShow">0</div>
      <p class="comment" id="resultComment">å¤§å§¨è‹¥æœ‰æ‰€æ€...</p>
      <button class="modal-btn" onclick="closeModal()"><span id="continueText">ç»§ç»­æˆ˜æ–—</span></button>
    </div>
  </div>

  <script>
    // è±†åŒ…APIé…ç½®
    const API_KEY = '7999abb8-d5ea-4312-b6d2-b46e5fb638a1';
    const MODEL_ID = 'doubao-seed-1-6-251015';
    
    // æ¸¸æˆçŠ¶æ€
    let game = { character: 'å¤§å§¨', hp: 100, maxHp: 100, round: 1, totalDamage: 0, winCount: 0 };
    
    // è§’è‰²é…ç½®
    const chars = {
      'å¤§å§¨': { hp: 100, firstQ: 'æ‰¾å¯¹è±¡äº†å—ï¼Ÿéƒ½28äº†ï¼Œè¯¥æ€¥äº†ï¼' },
      'å”å”': { hp: 100, firstQ: 'ç°åœ¨å·¥èµ„å¤šå°‘ï¼Ÿå¹´ç»ˆå¥–å‘äº†å¤šå°‘ï¼Ÿ' },
      'å¥¶å¥¶': { hp: 150, firstQ: 'ä»€ä¹ˆæ—¶å€™ç”Ÿå­©å­ï¼Ÿè¶å¹´è½»èµ¶ç´§ç”Ÿï¼' }
    };
    
    // ç›´æ¥è°ƒç”¨è±†åŒ…API
    async function callDoubao(userAnswer, question, hp, round) {
      const https = await import('https');
      
      return new Promise((resolve) => {
        const data = JSON.stringify({
          model: MODEL_ID,
          messages: [
            { role: 'system', content: 'ä½ æ˜¯äº²æˆšå¯¹æˆ˜è£åˆ¤ã€‚å¤§å§¨100HPï¼Œè¾“å‡ºJSONï¼š{"damage":10-40,"comment":"è¯„è¯­","next":"è¿½é—®","over":true/false}' },
            { role: 'user', content: `Q:"${question}" A:"${userAnswer}" HP:${hp}/100 R:${round}` }
          ],
          temperature: 0.7, max_tokens: 100
        });
        
        const req = https.default.request({
          hostname: 'ark.cn-beijing.volces.com',
          path: '/api/v3/chat/completions',
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
          timeout: 10000
        }, (res) => {
          let chunks = '';
          res.on('data', chunk => chunks += chunk);
          res.on('end', () => {
            try {
              const content = JSON.parse(chunks).choices[0].message.content;
              const damage = parseInt(content.match(/damage["\s:]+(\d+)/)?.[1] || Math.floor(Math.random() * 20 + 15));
              const over = content.includes('"over":true') || hp - damage <= 0;
              const nextQ = content.match(/next["\s:]+["]([^"]+)["]/)?.[1] || 'åˆ«æ‰¯åˆ«çš„ï¼Œä½ å°±è¯´åˆ°åº•æ€ä¹ˆæƒ³çš„ï¼Ÿ';
              
              resolve({ damage, over, next: nextQ });
            } catch (e) {
              // å¤‡ç”¨é€»è¾‘
              const damage = Math.floor(Math.random() * 20 + 15);
              resolve({ damage, over: hp - damage <= 0, next: 'åˆ«æ‰¯åˆ«çš„ï¼Œä½ å°±è¯´åˆ°åº•æ€ä¹ˆæƒ³çš„ï¼Ÿ' });
            }
          });
        });
        
        req.on('error', () => {
          const damage = Math.floor(Math.random() * 20 + 15);
          resolve({ damage, over: hp - damage <= 0, next: 'åˆ«æ‰¯åˆ«çš„ï¼Œä½ å°±è¯´åˆ°åº•æ€ä¹ˆæƒ³çš„ï¼Ÿ' });
        });
        req.setTimeout(10000, () => { req.destroy(); resolve({ damage: 20, over: false, next: '...' }); });
        req.write(data); req.end();
      });
    }
    
    function selectChar(char) {
      document.querySelectorAll('.char-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      game.character = char;
      game.hp = chars[char].hp;
      game.maxHp = chars[char].hp;
      game.round = 1;
      updateUI();
      document.getElementById('questionText').textContent = chars[char].firstQ;
    }
    
    async function submitAnswer() {
      const ans = document.getElementById('answerInput').value.trim();
      if (!ans) return;
      
      const q = document.getElementById('questionText').textContent;
      const result = await callDoubao(ans, q, game.hp, game.round);
      
      game.hp = Math.max(0, game.hp - result.damage);
      game.totalDamage += result.damage;
      
      showResult(result.damage, result.over);
      updateUI();
      
      if (result.over) {
        game.winCount++;
        setTimeout(() => { alert('ğŸ‰ æˆ˜æ–—èƒœåˆ©ï¼å¤§å§¨æ‚»æ‚»åœ°ç¦»å¼€äº†ï¼'); initGame(); }, 500);
      } else {
        game.round++;
        document.getElementById('questionText').textContent = result.next;
      }
      
      document.getElementById('answerInput').value = '';
    }
    
    function useQuick(txt) { document.getElementById('answerInput').value = txt; }
    function updateUI() {
      const pct = (game.hp / game.maxHp) * 100;
      document.getElementById('hpFill').style.width = pct + '%';
      document.getElementById('hpText').textContent = `${game.hp}/${game.maxHp}`;
      document.getElementById('hpPercent').textContent = Math.round(pct) + '%';
      document.getElementById('charName').textContent = { 'å¤§å§¨': 'ğŸ‘© å¤§å§¨', 'å”å”': 'ğŸ‘¨ å”å”', 'å¥¶å¥¶': 'ğŸ‘µ å¥¶å¥¶' }[game.character];
      document.getElementById('whoLabel').textContent = { 'å¤§å§¨': 'ğŸ‘© å¤§å§¨', 'å”å”': 'ğŸ‘¨ å”å”', 'å¥¶å¥¶': 'ğŸ‘µ å¥¶å¥¶' }[game.character] + ' è¯´ï¼š';
      document.getElementById('roundInfo').textContent = `ç¬¬ ${game.round} è½®`;
      document.getElementById('winCount').textContent = game.winCount;
      document.getElementById('totalDamage').textContent = game.totalDamage;
    }
    
    function showResult(dmg, over) {
      document.getElementById('damageShow').textContent = '-' + dmg;
      document.getElementById('continueText').textContent = over ? 'å†æ¥ä¸€å±€' : 'ç»§ç»­æˆ˜æ–—';
      document.getElementById('resultModal').classList.add('show');
    }
    function closeModal() { document.getElementById('resultModal').classList.remove('show'); }
    function initGame() { game.hp = chars[game.character].hp; game.round = 1; updateUI(); }
    
    initGame();
  </script>
</body>
</html>
